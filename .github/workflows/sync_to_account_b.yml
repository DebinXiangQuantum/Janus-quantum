name: Sync to Backup Account

on:
  push:
    branches:
      - main  # 或者你的主分支名称

jobs:
  build-and-push:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # 必须获取完整历史，防止 force push 冲突
      - name: Diagnostic Test
        run: |
          echo "Testing Classic URL..."
          git ls-remote https://${{ secrets.BACKUP_TOKEN }}@github.com/xiangdebinBackup/Janus-quantum.git HEAD
          
          echo "Testing with Username..."
          # 把下面的 'xiangdebinBackup' 替换为你账号B的真实用户名
          git ls-remote https://xiangdebinBackup:${{ secrets.BACKUP_TOKEN }}@github.com/xiangdebinBackup/Janus-quantum.git HEAD
      - name: Push to Account B
        run: |
          # 1. 配置 Git 用户信息（防止 Git 识别为匿名用户）
          git config --global user.email "xiangdebin3@gmail.com"
          git config --global user.name "xiangdebinBackup"

          # 2. 清除可能干扰的现有远程仓库
          git remote remove backup || true
          
          # 3. 关键点：将 Token 直接嵌入 URL，并移除可能干扰认证的 header
          # 注意：这里我们不再依赖环境自带的认证
          git remote add backup "https://${{ secrets.BACKUP_TOKEN }}@github.com/xiangdebinBackup/Janus-quantum.git"
          
          # 4. 执行推送
          # 使用 -u 建立追踪关系，--force 确保覆盖（如果这是你的意图）
          git push backup main
